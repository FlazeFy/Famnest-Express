// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum TaskStatus { 
  pending 
  in_progress 
  completed 
}

enum Gender { 
  male 
  female
}

enum DayName {
  sun
  mon
  tue
  wed
  thu
  fri
  sat
}

enum MealTime {
  breakfast
  lunch
  dinner
}

model dictionary {
  id              String   @id @db.Char(36)
  dictionary_name String   @unique @db.Char(36)
  dictionary_type String   @db.Char(36)
  dictionary_desc String?  @db.VarChar(255)
  created_at      DateTime @default(now()) @db.Timestamptz(6)

  // Relations
  family_members family_member[]
  schedules      schedule[]
  events         event[]
}

model user {
  id            String    @id @db.Char(36)
  username      String    @db.Char(36)
  password      String    @db.VarChar(500)
  email         String    @unique @db.VarChar(255)
  fullname      String    @db.Char(75)
  bio           String?   @db.VarChar(500)
  profile_image String?   @db.VarChar(500)
  born_at       DateTime? @db.Date
  gender        Gender
  created_at    DateTime  @default(now()) @db.Timestamptz(6)
  updated_at    DateTime  @updatedAt @db.Timestamptz(6)
  deleted_at    DateTime? @db.Timestamptz(6)

  // Relations
  histories             history[]
  allergics             allergic[]
  hobbies               hobby[]
  tasks                 task[]
  families              family[]
  google_tokens         google_token[]
  schedules             schedule[]
  events                event[]
  feedbacks             feedback[]
  family_members        family_member[]
  family_sleep_time     family_sleep_time[]
  meals                 meal[]
  meal_assigne          meal_prepare_by[] @relation("AssigneMeal")
  meal_prepare          meal_prepare_by[] @relation("PrepareMeal")
  task_assigns_created  task_assign[] @relation("TaskAssignCreator")
  task_assigns_assigned task_assign[] @relation("TaskAssignAssignee")
}

model family {
  id          String    @id @db.Char(36)
  family_name String    @db.VarChar(144)
  family_desc String?   @db.Text
  created_by  String    @db.Char(36)
  created_at  DateTime  @default(now()) @db.Timestamptz(6)
  updated_at  DateTime  @updatedAt @db.Timestamptz(6)
  deleted_at  DateTime? @db.Timestamptz(6)

  // Relation to User
  user user @relation(fields: [created_by], references: [id])

  // Relations
  tasks               task[]
  family_members      family_member[]
  family_sleep_time   family_sleep_time[]
  schedules           schedule[]
  events              event[]
  meals               meal[]
}

model admin {
  id                String    @id @db.Char(36)
  username          String    @db.Char(36)
  password          String    @db.VarChar(500)
  email             String    @unique @db.VarChar(255)
  telegram_user_id  String?   @unique @db.VarChar(10)
  telegram_is_valid Boolean   @default(false)
  // Metadata
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt
}

model feedback {
  id            String   @id @db.Char(36)
  feedback_rate Int
  feedback_body String   @db.VarChar(255)
  created_at    DateTime @db.Timestamp(6)
  created_by    String   @db.Char(36)
  
  // Relation to User
  user user @relation(fields: [created_by], references: [id])
}

model question {
  id            String   @id @db.Char(36)
  question      String   @db.VarChar(255)
  answer        String?  @db.VarChar(500)
  is_show       Boolean  @default(false)
  created_at    DateTime @db.Timestamp(6)
  email         String   @db.VarChar(255)
}

model history {
  id              String   @id @db.Char(36)
  history_type    String   @db.Char(36)
  history_context String   @db.Char(36)
  created_by      String   @db.Char(36)
  created_at      DateTime @default(now()) @db.Timestamptz(6)

  // Relation to User
  user user @relation(fields: [created_by], references: [id])
}

model allergic {
  id               String   @id @db.Char(36)
  allergic_context String   @db.Char(36)
  allergic_desc    String?  @db.VarChar(255)
  created_by       String   @db.Char(36)
  created_at       DateTime @default(now()) @db.Timestamptz(6)
  updated_at       DateTime @updatedAt @db.Timestamptz(6)

  // Relation to User
  user user @relation(fields: [created_by], references: [id])
}

model hobby {
  id            String   @id @db.Char(36)
  hobby_context String   @db.Char(36)
  hobby_desc    String?  @db.VarChar(255)
  created_by    String   @db.Char(36)
  created_at    DateTime @default(now()) @db.Timestamptz(6)
  updated_at    DateTime @updatedAt @db.Timestamptz(6)

  // Relation to User
  user user @relation(fields: [created_by], references: [id])
}

model task {
  id         String     @id @db.Char(36)
  family_id  String     @db.Char(36)
  task_title String     @db.VarChar(255)
  task_desc  String?    @db.Text
  status     TaskStatus @default(pending)
  start_date DateTime?  @db.Timestamptz(6)
  due_date   DateTime?  @db.Timestamptz(6)
  created_by String     @db.Char(36)
  created_at DateTime   @default(now()) @db.Timestamptz(6)
  updated_at DateTime   @updatedAt @db.Timestamptz(6)
  tags       String[]   

  // Relations
  family family @relation(fields: [family_id], references: [id])
  user   user   @relation(fields: [created_by], references: [id])

  task_assigns task_assign[]
}

model task_assign {
  id          String   @id @db.Char(36)
  task_id     String   @db.Char(36)
  assign_desc String?  @db.VarChar(144)
  assign_to   String   @db.Char(36)
  created_by  String   @db.Char(36)
  created_at  DateTime @default(now()) @db.Timestamptz(6)
  updated_at  DateTime @updatedAt @db.Timestamptz(6)

  // Relations
  task     task @relation(fields: [task_id], references: [id])
  creator  user @relation("TaskAssignCreator", fields: [created_by], references: [id])
  assignee user @relation("TaskAssignAssignee", fields: [assign_to], references: [id])
}

model google_token {
  id            String   @id @db.Char(36)
  access_token  String   @db.Text
  refresh_token String   @db.Text
  expiry        DateTime @db.Timestamptz(6)
  created_by    String   @db.Char(36)

  // Relation to User
  user user @relation(fields: [created_by], references: [id])
}

model schedule {
  id                String   @id @db.Char(36)
  family_id         String   @db.Char(36)
  created_by        String   @db.Char(36)
  schedule_title    String   @db.VarChar(144)
  schedule_desc     String?  @db.VarChar(500)
  schedule_category String   @db.Char(36)
  day               DayName 
  time_start        String   @db.Char(5)
  time_end          String   @db.Char(5)
  created_at        DateTime @default(now()) @db.Timestamptz(6)
  updated_at        DateTime @updatedAt @db.Timestamptz(6)

  // Relations
  family     family     @relation(fields: [family_id], references: [id])
  user       user       @relation(fields: [created_by], references: [id])
  dictionary dictionary @relation(fields: [schedule_category], references: [dictionary_name])
}

model event {
  id                       String   @id @db.Char(36)
  family_id                String   @db.Char(36)
  google_calendar_event_id String?  @db.Char(36)
  event_title              String   @db.VarChar(255)
  event_desc               String?  @db.Text
  event_category           String   @db.VarChar(75)
  event_start_time         DateTime @db.Timestamptz(6)
  event_end_time           DateTime @db.Timestamptz(6)
  created_by               String   @db.Char(36)
  created_at               DateTime @default(now()) @db.Timestamptz(6)
  updated_at               DateTime @updatedAt @db.Timestamptz(6)

  // Relations
  family     family     @relation(fields: [family_id], references: [id])
  user       user       @relation(fields: [created_by], references: [id])
  dictionary dictionary @relation(fields: [event_category], references: [dictionary_name])
}

model family_member {
  id              String   @id @db.Char(36)
  family_id       String   @db.Char(36)
  family_relation String   @db.Char(36)
  user_id         String   @db.Char(36)
  is_admin        Boolean  @default(false)
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  updated_at      DateTime @updatedAt @db.Timestamptz(6)

  // Relations
  family     family     @relation(fields: [family_id], references: [id])
  user       user       @relation(fields: [user_id], references: [id])
  dictionary dictionary @relation(fields: [family_relation], references: [dictionary_name])
}

model family_sleep_time {
  id              String   @id @db.Char(36)
  family_id       String   @db.Char(36)
  hour_start      String   @db.Char(5)
  hour_end        String   @db.Char(5)
  created_by      String   @db.Char(36)
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  updated_at      DateTime @updatedAt @db.Timestamptz(6)

  // Relations
  family     family     @relation(fields: [family_id], references: [id])
  user       user       @relation(fields: [created_by], references: [id])
}

model meal {
  id              String   @id @db.Char(36)
  culineira_id    String?  @db.Char(36)
  family_id       String   @db.Char(36)
  meal_name       String   @db.Char(75)
  meal_desc       String?  @db.Char(255)
  meal_day        DayName
  meal_time       MealTime
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  updated_at      DateTime @updatedAt @db.Timestamptz(6)
  created_by      String   @db.Char(36)

  // Relations
  family  family  @relation(fields: [family_id], references: [id])
  user    user @relation(fields: [created_by], references: [id])

  meal_prepare_bys  meal_prepare_by[]
}

model meal_prepare_by {
  id              String   @id @db.Char(36)
  meal_id         String   @db.Char(36)
  prepare_by      String   @db.Char(36)
  created_at      DateTime @default(now()) @db.Timestamptz(6)
  created_by      String   @db.Char(36)

  // Relations
  meal          meal  @relation(fields: [meal_id], references: [id])
  user_assigne  user  @relation("AssigneMeal", fields: [created_by], references: [id])
  user_prepare  user  @relation("PrepareMeal", fields: [prepare_by], references: [id])
}